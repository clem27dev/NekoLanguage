// Bot de sondage Discord en nekoScript
// Ce bot permet de cr√©er des sondages interactifs avec r√©actions

// Importer le module Discord
importer Discord;

// Configuration du bot
nekVariable TOKEN = "VOTRE_TOKEN_DISCORD_ICI";
nekVariable PREFIX = "!";

// Cr√©ation et configuration du bot
nekVariable bot = nekCr√©erBot(TOKEN)
  .changerStatut("Sondages | !sondage", "ACTIVITE_REGARDE");

// Initialisation des emojis pour les options (jusqu'√† 10 options)
nekVariable emojisOptions = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"];

// Quand le bot est pr√™t
bot.surConnexion(function(info) {
  nekAfficher("Bot de sondage connect√© sous le nom " + info.tag);
  nekAfficher("Pr√©sent sur " + info.serveurs + " serveurs");
});

// Fonction pour extraire les options du message
nekFonction extraireOptions(message) {
  // Format attendu: !sondage "Question" "Option 1" "Option 2" ...
  // Rechercher les textes entre guillemets
  nekVariable regex = /"([^"]*)"/g;
  nekVariable matches = [];
  nekVariable match;
  
  // Rechercher tous les textes entre guillemets
  tantque ((match = regex.exec(message)) !== null) {
    matches.push(match[1]);
  }
  
  // S'il n'y a pas au moins une question et une option
  si (matches.length < 2) {
    retourner null;
  }
  
  // Premi√®re correspondance = question, le reste = options
  nekVariable question = matches[0];
  nekVariable options = matches.slice(1);
  
  // Limiter √† 10 options maximum
  si (options.length > 10) {
    options = options.slice(0, 10);
  }
  
  retourner {
    question: question,
    options: options
  };
}

// Fonction pour cr√©er un sondage
nekFonction creerSondage(message, sondageData) {
  // Cr√©er la description du sondage avec les options num√©rot√©es
  nekVariable description = "Votez en cliquant sur les r√©actions ci-dessous!\n\n";
  
  pour (nekVariable i = 0; i < sondageData.options.length; i++) {
    description += emojisOptions[i] + " " + sondageData.options[i] + "\n";
  }
  
  // Cr√©er l'embed du sondage
  nekVariable embed = bot.cr√©erEmbed(
    "üìä Sondage: " + sondageData.question,
    description,
    "#ff9900"
  )
  .d√©finirFooter("Sondage cr√©√© par " + message.auteur, null)
  .d√©finirAuteur(bot.client.user.username, bot.client.user.displayAvatarURL());
  
  // Envoyer le sondage et ajouter les r√©actions pour voter
  message.r√©pondre({ embeds: [embed.embed] }).then(function(msg) {
    // Ajouter une r√©action pour chaque option
    pour (nekVariable i = 0; i < sondageData.options.length; i++) {
      setTimeout(function(index) {
        msg.r√©action(emojisOptions[index]);
      }, i * 500, i);  // Ajouter un d√©lai pour √©viter les limitations de l'API
    }
  });
}

// G√©rer les messages re√ßus
bot.surMessage(function(message) {
  // Ignorer les messages du bot lui-m√™me
  si (message.auteurId === bot.client.user.id) {
    retourner;
  }
  
  // V√©rifier si le message commence par le pr√©fixe de commande
  si (message.contenu.startsWith(PREFIX) === false) {
    retourner;
  }

  // Parser la commande
  nekVariable commande = parseCommandes(PREFIX, message.contenu);
  
  // Commande de sondage
  si (commande.commandName === "sondage") {
    // Extraire la question et les options du message
    nekVariable sondageData = extraireOptions(message.contenu);
    
    si (sondageData === null) {
      message.r√©pondre("‚ö†Ô∏è Format incorrect! Utilisez: `" + PREFIX + "sondage \"Question\" \"Option 1\" \"Option 2\" ...`");
      retourner;
    }
    
    // Cr√©er le sondage
    creerSondage(message, sondageData);
  }
  
  // Commande d'aide
  si (commande.commandName === "aide" || commande.commandName === "help") {
    nekVariable embed = bot.cr√©erEmbed(
      "Aide - Bot de Sondage",
      "Voici comment utiliser ce bot:",
      "#ff9900"
    )
    .ajouterChamp(
      PREFIX + "sondage \"Question\" \"Option 1\" \"Option 2\" ...", 
      "Cr√©e un sondage avec la question et les options sp√©cifi√©es (max 10 options)", 
      false
    )
    .ajouterChamp(
      "Exemple", 
      PREFIX + "sondage \"Quelle est votre couleur pr√©f√©r√©e?\" \"Rouge\" \"Bleu\" \"Vert\"", 
      false
    )
    .ajouterChamp(
      PREFIX + "aide", 
      "Affiche ce message d'aide", 
      false
    )
    .d√©finirFooter("Bot de sondage cr√©√© avec nekoScript üê±");
    
    message.r√©pondre({ embeds: [embed.embed] });
  }
});