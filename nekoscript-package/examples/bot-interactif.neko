// Bot Discord interactif en nekoScript
// Ce bot utilise des rÃ©actions et des boutons pour interagir avec les utilisateurs

// Importer le module Discord
importer Discord;

// Configuration du bot
nekVariable TOKEN = "VOTRE_TOKEN_DISCORD_ICI";
nekVariable PREFIX = "!";

// CrÃ©ation du bot avec statut personnalisÃ©
nekVariable bot = nekCrÃ©erBot(TOKEN)
  .changerStatut("ğŸ® Interactif | !jeu", "JOUE");

// Variable pour stocker les scores
nekVariable scores = {};

// Quand le bot est prÃªt
bot.surConnexion(function(info) {
  nekAfficher("Bot interactif connectÃ© sous le nom " + info.tag);
});

// Fonction pour crÃ©er une partie de pierre-papier-ciseaux
nekFonction creerJeuPPC(message) {
  // CrÃ©er un embed pour le jeu
  nekVariable embed = bot.crÃ©erEmbed(
    "ğŸ® Pierre-Papier-Ciseaux",
    "Choisissez votre coup en cliquant sur une rÃ©action:",
    "#3498db"
  )
  .ajouterChamp("Pierre ğŸª¨", "Bat les ciseaux", true)
  .ajouterChamp("Papier ğŸ“", "Bat la pierre", true)
  .ajouterChamp("Ciseaux âœ‚ï¸", "Bat le papier", true)
  .dÃ©finirFooter("Jeu contre " + bot.client.user.username);
  
  // Envoyer l'embed et ajouter des rÃ©actions
  message.rÃ©pondre({ embeds: [embed.embed] }).then(function(msg) {
    // Ajouter les rÃ©actions pour les choix
    msg.rÃ©action("ğŸª¨");  // Pierre
    msg.rÃ©action("ğŸ“");  // Papier
    msg.rÃ©action("âœ‚ï¸");  // Ciseaux
    
    // CrÃ©er un collecteur de rÃ©actions
    nekVariable filter = (reaction, user) => {
      return ["ğŸª¨", "ğŸ“", "âœ‚ï¸"].includes(reaction.emoji.name) && 
             user.id === message.auteurId;
    };
    
    // Collecter la rÃ©action de l'utilisateur
    msg.awaitReactions({ filter, max: 1, time: 30000 })
      .then(collected => {
        nekVariable reaction = collected.first();
        si (reaction === undefined) {
          message.rÃ©pondre("Temps Ã©coulÃ© â±ï¸");
          retourner;
        }
        
        // DÃ©terminer le choix de l'utilisateur
        nekVariable choixUtilisateur = "";
        si (reaction.emoji.name === "ğŸª¨") choixUtilisateur = "pierre";
        sinon si (reaction.emoji.name === "ğŸ“") choixUtilisateur = "papier";
        sinon si (reaction.emoji.name === "âœ‚ï¸") choixUtilisateur = "ciseaux";
        
        // Choix alÃ©atoire du bot
        nekVariable options = ["pierre", "papier", "ciseaux"];
        nekVariable choixBot = options[Math.floor(Math.random() * options.length)];
        
        // DÃ©terminer le gagnant
        nekVariable resultat = "";
        si (choixUtilisateur === choixBot) {
          resultat = "Ã‰galitÃ©! ğŸ¤";
        } sinon si (
          (choixUtilisateur === "pierre" && choixBot === "ciseaux") ||
          (choixUtilisateur === "papier" && choixBot === "pierre") ||
          (choixUtilisateur === "ciseaux" && choixBot === "papier")
        ) {
          resultat = "Vous avez gagnÃ©! ğŸ‰";
          
          // Mettre Ã  jour le score
          si (scores[message.auteurId] === undefined) {
            scores[message.auteurId] = 1;
          } sinon {
            scores[message.auteurId] += 1;
          }
        } sinon {
          resultat = "J'ai gagnÃ©! ğŸ¤–";
        }
        
        // Afficher le rÃ©sultat
        nekVariable emojis = {
          "pierre": "ğŸª¨",
          "papier": "ğŸ“",
          "ciseaux": "âœ‚ï¸"
        };
        
        nekVariable scoreActuel = scores[message.auteurId] || 0;
        
        nekVariable embedResultat = bot.crÃ©erEmbed(
          "RÃ©sultat du jeu",
          resultat,
          "#3498db"
        )
        .ajouterChamp("Votre choix", emojis[choixUtilisateur] + " " + choixUtilisateur, true)
        .ajouterChamp("Mon choix", emojis[choixBot] + " " + choixBot, true)
        .ajouterChamp("Votre score", scoreActuel + " points", false)
        .dÃ©finirFooter("Tapez " + PREFIX + "jeu pour jouer Ã  nouveau");
        
        message.rÃ©pondre({ embeds: [embedResultat.embed] });
      });
  });
}

// GÃ©rer les messages reÃ§us
bot.surMessage(function(message) {
  // Ignorer les messages du bot
  si (message.auteurId === bot.client.user.id) {
    retourner;
  }
  
  // Commande pour jouer Ã  pierre-papier-ciseaux
  si (message.contenu === PREFIX + "jeu") {
    creerJeuPPC(message);
  }
  
  // Commande pour afficher le score
  si (message.contenu === PREFIX + "score") {
    nekVariable score = scores[message.auteurId] || 0;
    message.rÃ©pondre("ğŸ† Votre score actuel: " + score + " points");
  }
  
  // Commande d'aide
  si (message.contenu === PREFIX + "aide") {
    nekVariable embed = bot.crÃ©erEmbed(
      "Commandes disponibles",
      "Voici les commandes que vous pouvez utiliser:",
      "#3498db"
    )
    .ajouterChamp(PREFIX + "jeu", "Jouer Ã  Pierre-Papier-Ciseaux", false)
    .ajouterChamp(PREFIX + "score", "Afficher votre score actuel", false)
    .ajouterChamp(PREFIX + "aide", "Afficher cette aide", false)
    .dÃ©finirFooter("Bot interactif crÃ©Ã© avec nekoScript ğŸ±");
    
    message.rÃ©pondre({ embeds: [embed.embed] });
  }
  
  // RÃ©pondre aux messages qui contiennent "bonjour"
  si (message.contenu.toLowerCase().includes("bonjour")) {
    message.rÃ©action("ğŸ‘‹");
  }
});